---
import Layout from "../layouts/Layout.astro";
import { products, categories } from "../data/products";
console.log("Productos cargados en Astro:", products?.length);

// ===== CONFIGURACI√ìN DEL NEGOCIO (EDITABLE) =====
const WHATSAPP_NUMBER = "3572548014";
const ALIAS_TRANSFERENCIA = "benny.burgers"; // ‚¨ÖÔ∏è CAMBIAR ESTO
const HORA_ENTREGA_ESTIMADA = "35-45"; // ‚¨ÖÔ∏è CAMBIAR ESTO (en minutos)
const COSTO_ENVIO = 3000; // ‚¨ÖÔ∏è CAMBIAR ESTO
// ================================================
---

<Layout title="Benny¬¥s">
  <main class="min-h-screen relative" style="z-index: 1;">
    <section class="container mx-auto px-4 py-8">
      <!-- HEADER / NAV CON LOGO + BOT√ìN CARRITO -->
      <section
        class="fixed top-0 left-0 w-full z-50 bg-zinc-950/95 backdrop-blur border-b border-zinc-800 px-4 py-4"
      >
        <div class="flex flex-col sm:flex-row items-center sm:items-center justify-between gap-4">
          <a href="/" class="flex flex-col sm:flex-row items-center gap-3 hover:opacity-80 transition">
            <img 
              src="logo_bennys.png" 
              alt="Benny's Logo" 
              class="h-18 w-auto object-contain"
            />
          </a>

          <button
            id="btn-open-cart"
            class="inline-flex items-center gap-2 rounded-full border border-red-600 bg-zinc-900 px-4 py-2 text-sm font-medium text-red-400 hover:bg-red-600 hover:text-white transition shadow-md shadow-red-500/30"
            type="button"
            aria-label="Abrir carrito de compras"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
              ></path>
            </svg>
            <span>Carrito</span>
            <span
              id="cart-count"
              class="text-xs bg-red-600 text-white rounded-full px-2 py-[2px] font-bold min-w-[20px] text-center"
            >
              0
            </span>
          </button>
        </div>
      </section>

      <!-- BANNER DE INFORMACI√ìN IMPORTANTE -->
      <section class="pt-[140px] sm:pt-[110px] pb-6 px-4">
        <div class="container mx-auto">

          <!-- Estado de negocio y horarios -->
          <div
            id="status-banner"
            class="bg-black border border-green-500 rounded-2xl p-4 mb-4 flex flex-col sm:flex-row items-start sm:items-center gap-3"
          >
            <div class="flex items-center gap-2">
              <div
                id="status-indicator"
                class="w-3 h-3 bg-green-400 rounded-full animate-pulse"
              ></div>
              <span
                id="status-text"
                class="text-green-400 font-semibold text-sm"
              >
                Abierto ahora
              </span>
            </div>

            <div class="flex flex-wrap gap-3 text-xs text-zinc-300">
              <span>üïê Lun-Dom: 19:00 - 00:00</span>
              <span id="delivery-time">‚è±Ô∏è Entrega en {HORA_ENTREGA_ESTIMADA} min</span>
            </div>
          </div>

          <!-- Info de zona y m√©todos de pago -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">

            <!-- Zona de entrega -->
            <div class="bg-zinc-950 border border-zinc-800 rounded-xl p-4">
              <h3
                class="text-sm font-semibold text-zinc-50 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-4 h-4 text-red-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                  />
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                  />
                </svg>
                Zona de entrega
              </h3>

              <p class="text-xs text-zinc-400 mb-2">Pilar</p>

              <div class="flex items-center gap-2 text-xs">
                <span class="bg-zinc-800 px-2 py-1 rounded text-zinc-300">
                  Env√≠o: ${COSTO_ENVIO.toLocaleString("es-AR")}
                </span>
                <span class="text-red-400">¬∑ Retiro gratis</span>
              </div>
            </div>

            <!-- M√©todos de pago -->
            <div class="bg-zinc-950 border border-zinc-800 rounded-xl p-4">
              <h3
                class="text-sm font-semibold text-zinc-50 mb-2 flex items-center gap-2"
              >
                <svg
                  class="w-4 h-4 text-red-600"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"
                />
                </svg>
                M√©todos de pago
              </h3>

              <div class="flex flex-wrap gap-2 mb-3">
                <span class="bg-zinc-800 px-3 py-1 rounded-full text-xs text-zinc-300">
                  üü¢ Transferencia
                </span>
                <span class="bg-zinc-800 px-3 py-1 rounded-full text-xs text-zinc-300">
                  üíµ Efectivo
                </span>
              </div>

              <div class="bg-zinc-900 border border-zinc-700 rounded-lg p-2 mt-2">
                <p class="text-xs text-zinc-400 mb-1">Alias CBU:</p>
                <p class="text-sm font-mono text-green-400 font-semibold">{ALIAS_TRANSFERENCIA}</p>
              </div>
            </div>

          </div>
        </div>
      </section>

      <!-- FILTROS -->
      <section id="filters" class="flex flex-wrap gap-3 justify-center mb-8 text-sm px-4">
        {categories.map((cat) => (
          <button
            type="button"
            data-filter={cat.id}
            class={`filter-btn px-6 py-2.5 rounded-full border-2 text-xs uppercase tracking-wider font-bold transition-all duration-300 ${
              cat.id === "todos"
                ? "active bg-red-600 border-white text-white shadow-lg shadow-red-500/50"
                : "bg-black border-white text-zinc-200 hover:bg-zinc-700 hover:border-zinc-500"
            }`}
            aria-label={`Filtrar por ${cat.name}`}
          >
            {cat.name}
          </button>
        ))}
      </section>

      <!-- CONTADOR DE PRODUCTOS -->
      <p class="mb-4 text-center">
        <span class="inline-block bg-zinc-950/90 text-zinc-100 text-xs px-4 py-2 rounded-full border border-zinc-800">
          Mostrando <span id="products-count" class="font-semibold text-white">{products.length}</span> productos
        </span>
      </p>

      <!-- GRID DE PRODUCTOS -->
      <section id="products-grid" class="grid gap-6 grid-cols-1 sm:grid-cols-2 lg:grid-cols-3">
        {products.map((product) => (
          <article
            class="product-card bg-zinc-900/90 border border-zinc-800 rounded-2xl overflow-hidden flex flex-col shadow-lg shadow-black/50 hover:-translate-y-1 hover:shadow-2xl hover:border-zinc-700 transition-all duration-300"
            data-category={product.category}
            data-id={product.id}
            data-price={product.price || 0}
            data-name={product.name}
            data-description={product.description}
            data-ingredients={product.ingredients ? JSON.stringify(product.ingredients) : "[]"}
            style="animation: fadeIn 0.5s ease-out"
          >
            <div class="h-56 w-full bg-zinc-800 overflow-hidden relative">
              <img
                data-src={product.image}
                alt={`${product.name} - ${product.description}`}
                class="product-image h-full w-full object-cover hover:scale-105 transition-all duration-500 opacity-0"
                loading="lazy"
                src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 400 300'%3E%3Crect fill='%2327272a' width='400' height='300'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' fill='%2352525b' font-family='sans-serif' font-size='14'%3ECargando...%3C/text%3E%3C/svg%3E"
              />
              {product.badge && (
                <span
                  class={`absolute top-3 right-3 px-3 py-1 rounded-full text-xs font-bold shadow-lg ${
                    product.badge === "popular"
                      ? "bg-red-600 text-white"
                      : "bg-green-500 text-white"
                  }`}
                >
                  {product.badge === "popular" ? "üî• Popular" : "‚ú® Nuevo"}
                </span>
              )}
            </div>

            <div class="p-4 flex flex-col flex-1">
              <div class="flex items-start justify-between gap-2 mb-2">
                <h3 class="font-semibold text-red-500 text-sm product-name">
                  {product.name}
                </h3>
                <span class="text-red-500 font-bold text-sm whitespace-nowrap product-price">
                  {product.category === "bebidas" || product.category === "postres" 
                    ? `$${product.price.toLocaleString("es-AR")}`
                    : "Desde $10.900"
                  }
                </span>
              </div>

              <p class="text-xs text-zinc-400 mb-3 line-clamp-2 product-description">
                {product.description}
              </p>

              <div class="mt-auto flex gap-2">
                {(product.category === "bebidas" || product.category === "postres") ? (
                  <button
                    type="button"
                    class="btn-add w-full rounded-full bg-red-600 px-3 py-2 text-[11px] font-semibold text-white hover:bg-red-700 transition active:scale-95"
                    data-product-id={product.id}
                    aria-label={`Agregar ${product.name} al carrito`}
                  >
                    Agregar al carrito
                  </button>
                ) : (
                  <>
                    <button
                      type="button"
                      class="btn-customize flex-1 rounded-full border border-zinc-600 px-3 py-2 text-[11px] font-medium text-zinc-200 hover:bg-zinc-800 hover:border-zinc-500 transition"
                      data-product-id={product.id}
                      aria-label={`Personalizar ${product.name}`}
                    >
                      Personalizar
                    </button>
                    <button
                      type="button"
                      class="btn-add flex-1 rounded-full bg-red-600 px-3 py-2 text-[11px] font-semibold text-white hover:bg-red-700 transition active:scale-95"
                      data-product-id={product.id}
                      aria-label={`Agregar ${product.name} al carrito`}
                    >
                      Agregar
                    </button>
                  </>
                )}
              </div>
            </div>
          </article>
        ))}
      </section>
    </section>

    <!-- MODAL DEL CARRITO -->
    <div
      id="cart-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
      aria-labelledby="cart-title"
    >
      <div
        class="bg-zinc-900 border border-zinc-800 rounded-2xl max-w-md w-full max-h-[90vh] overflow-hidden shadow-2xl animate-slide-up"
      >
        <!-- Header del modal -->
        <div class="flex items-center justify-between p-6 border-b border-zinc-800">
          <h2 id="cart-title" class="text-xl font-semibold text-zinc-50">
            Tu Pedido
          </h2>
          <button
            id="btn-close-cart"
            class="text-zinc-400 hover:text-zinc-200 transition"
            type="button"
            aria-label="Cerrar carrito"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Contenido del carrito -->
        <div id="cart-items" class="p-6 overflow-y-auto max-h-[50vh]">
          <p class="text-zinc-400 text-sm text-center py-8">
            Tu carrito est√° vac√≠o
          </p>
        </div>

        <!-- Footer con total y botones -->
        <div class="p-6 border-t border-zinc-800 bg-zinc-950/50">
          <div class="flex items-center justify-between mb-4">
            <span class="text-zinc-400 text-sm">Total:</span>
            <span id="cart-total" class="text-2xl font-bold text-red-400">
              $0
            </span>
          </div>

          <div class="flex gap-2 mb-3">
            <button
              id="btn-clear-cart"
              class="flex-1 rounded-full bg-zinc-800 hover:bg-zinc-700 px-4 py-2 text-xs font-medium text-zinc-300 transition disabled:opacity-50 disabled:cursor-not-allowed"
              type="button"
              disabled
            >
              Vaciar carrito
            </button>
          </div>

          <button
            id="btn-whatsapp"
            class="w-full rounded-full bg-green-600 hover:bg-green-500 px-6 py-3 text-sm font-semibold text-white transition flex items-center justify-center gap-2 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed"
            type="button"
            disabled
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"
              ></path>
            </svg>
            Continuar con el pedido
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL DE M√âTODO DE PAGO Y COMPROBANTE -->
    <div
      id="payment-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm z-[60] hidden items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
    >
      <div class="bg-zinc-900 border border-zinc-800 rounded-2xl max-w-md w-full shadow-2xl animate-slide-up overflow-hidden">
        <!-- Header -->
        <div class="flex items-center justify-between p-6 border-b border-zinc-800">
          <h2 class="text-xl font-semibold text-zinc-50">
            Confirmar pedido
          </h2>
          <button
            id="btn-close-payment"
            class="text-zinc-400 hover:text-zinc-200 transition"
            type="button"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
          </button>
        </div>

        <!-- Contenido -->
        <div class="p-6 overflow-y-auto max-h-[70vh]">
          <!-- M√©todo de pago -->
          <div class="mb-6">
            <h3 class="text-sm font-semibold text-zinc-100 mb-3">
              ¬øC√≥mo vas a pagar?
            </h3>
            <div class="flex flex-col gap-2">
              <label class="payment-option flex items-center justify-between bg-zinc-800 rounded-xl px-4 py-3 cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent">
                <div class="flex items-center gap-3">
                  <input
                    type="radio"
                    name="payment-method"
                    class="payment-radio w-5 h-5"
                    value="transferencia"
                    checked
                  />
                  <div>
                    <span class="text-sm font-medium text-zinc-100">üü¢ Transferencia</span>
                    <span class="text-xs text-zinc-400 block">Envi√° el comprobante por WhatsApp</span>
                  </div>
                </div>
              </label>

              <label class="payment-option flex items-center justify-between bg-zinc-800 rounded-xl px-4 py-3 cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent">
                <div class="flex items-center gap-3">
                  <input
                    type="radio"
                    name="payment-method"
                    class="payment-radio w-5 h-5"
                    value="efectivo"
                  />
                  <div>
                    <span class="text-sm font-medium text-zinc-100">üíµ Efectivo</span>
                    <span class="text-xs text-zinc-400 block">Pag√°s al recibir</span>
                  </div>
                </div>
              </label>
            </div>
          </div>

          <!-- Datos de transferencia (solo si es transferencia) -->
          <div id="transfer-info" class="mb-6">
            <div class="bg-zinc-950 border border-green-500/30 rounded-xl p-4">
              <h4 class="text-sm font-semibold text-green-400 mb-3 flex items-center gap-2">
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                Datos para transferir
              </h4>
              <div class="space-y-2">
                <div class="flex justify-between items-center">
                  <span class="text-xs text-zinc-400">Alias CBU:</span>
                  <div class="flex items-center gap-2">
                    <span class="text-sm font-mono text-green-400 font-bold">{ALIAS_TRANSFERENCIA}</span>
                    <button
                      id="btn-copy-alias"
                      class="text-zinc-400 hover:text-green-400 transition"
                      type="button"
                      title="Copiar alias"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                      </svg>
                    </button>
                  </div>
                </div>
                <div class="flex justify-between items-center">
                  <span class="text-xs text-zinc-400">Monto:</span>
                  <span id="payment-total" class="text-lg font-bold text-green-400">$0</span>
                </div>
              </div>
              <div class="mt-3 bg-zinc-900 rounded-lg p-3">
                <p class="text-xs text-zinc-300">
                  ‚ö†Ô∏è <strong>Importante:</strong> Despu√©s de transferir, adjunt√° el comprobante en el chat de WhatsApp.
                </p>
              </div>
            </div>
          </div>

          <!-- Instrucciones de efectivo (solo si es efectivo) -->
          <div id="cash-info" class="mb-6 hidden">
            <div class="bg-zinc-950 border border-zinc-700 rounded-xl p-4">
              <h4 class="text-sm font-semibold text-zinc-100 mb-2 flex items-center gap-2">
                üíµ Pago en efectivo
              </h4>
              <p class="text-xs text-zinc-300">
                Pag√°s al momento de recibir tu pedido. Ten√© el monto exacto o lo m√°s aproximado posible.
              </p>
              <div class="mt-3 bg-zinc-900 rounded-lg p-3">
                <div class="flex justify-between items-center">
                  <span class="text-xs text-zinc-400">Total a pagar:</span>
                  <span id="cash-total" class="text-lg font-bold text-red-400">$0</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Direcci√≥n de entrega -->
          <div class="mb-4">
            <label class="block text-sm font-medium text-zinc-300 mb-2">
              üìç Direcci√≥n de entrega:
            </label>
            <textarea
              id="delivery-address"
              class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-200 focus:outline-none focus:ring-2 focus:ring-red-600"
              rows="2"
              placeholder="Calle, n√∫mero, piso/depto, referencias..."
              required
            ></textarea>
          </div>
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-zinc-800">
          <button
            id="btn-send-order"
            class="w-full rounded-full bg-green-600 hover:bg-green-500 px-6 py-3 text-sm font-semibold text-white transition flex items-center justify-center gap-2 active:scale-95"
            type="button"
          >
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"></path>
            </svg>
            Enviar pedido por WhatsApp
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL DE PERSONALIZACI√ìN -->
    <div
      id="customize-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
    >
      <div
        class="bg-zinc-900 border border-zinc-800 rounded-2xl max-w-md w-full max-h-[95vh] overflow-hidden shadow-2xl flex flex-col"
      >
        <div class="flex items-center justify-between p-4 sm:p-6 border-b border-zinc-800 flex-shrink-0">
          <h2 class="text-lg sm:text-xl font-semibold text-zinc-50">
            Personalizar producto
          </h2>
          <button
            id="btn-close-customize"
            class="text-zinc-400 hover:text-zinc-200 transition"
            type="button"
          >
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <div class="p-4 sm:p-6 overflow-y-auto flex-1">
          <div id="customize-content">
            <div class="mb-6">
              <h3 class="text-sm font-semibold text-zinc-100 mb-2">
                ¬øCu√°ntas carnes quer√©s? üçî
              </h3>
              <p class="text-xs text-zinc-400 mb-3">
                Eleg√≠ el tama√±o de tu hamburguesa:
              </p>
              <div class="flex flex-col gap-2">
                <label class="size-option flex items-center justify-between bg-zinc-800 rounded-xl px-4 py-3 cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent">
                  <div class="flex items-center gap-3">
                    <input type="radio" name="burger-size" class="size-radio w-5 h-5" value="simple" data-price="10900" checked />
                    <div>
                      <span class="text-sm font-medium text-zinc-100">Simple</span>
                      <span class="text-xs text-zinc-400 block">1 carne</span>
                    </div>
                  </div>
                  <span class="text-sm font-bold text-red-400">$10.900</span>
                </label>

                <label class="size-option flex items-center justify-between bg-zinc-800 rounded-xl px-4 py-3 cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent">
                  <div class="flex items-center gap-3">
                    <input type="radio" name="burger-size" class="size-radio w-5 h-5" value="doble" data-price="12900" />
                    <div>
                      <span class="text-sm font-medium text-zinc-100">Doble</span>
                      <span class="text-xs text-zinc-400 block">2 carnes</span>
                    </div>
                  </div>
                  <span class="text-sm font-bold text-red-400">$12.900</span>
                </label>

                <label class="size-option flex items-center justify-between bg-zinc-800 rounded-xl px-4 py-3 cursor-pointer hover:bg-zinc-700 transition border-2 border-transparent">
                  <div class="flex items-center gap-3">
                    <input type="radio" name="burger-size" class="size-radio w-5 h-5" value="triple" data-price="14900" />
                    <div>
                      <span class="text-sm font-medium text-zinc-100">Triple</span>
                      <span class="text-xs text-zinc-400 block">3 carnes</span>
                    </div>
                  </div>
                  <span class="text-sm font-bold text-red-400">$14.900</span>
                </label>
              </div>
            </div>

            <div id="remove-ingredients-section" class="mb-6"></div>

            <div class="mb-6">
              <h3 class="text-sm font-semibold text-zinc-100 mb-2">
                Extras (se suman al precio):
              </h3>
              <p class="text-xs text-zinc-400 mb-3">
                Eleg√≠ si quer√©s agregar algo extra a tu pedido. El importe se suma al precio base.
              </p>
              <div class="flex flex-wrap gap-2 text-xs text-zinc-200">
                <label class="inline-flex items-center gap-2 bg-zinc-800 rounded-full px-4 py-2.5 cursor-pointer hover:bg-zinc-700 transition active:bg-zinc-600">
                  <input type="checkbox" class="opt-extra w-4 h-4 rounded border-zinc-600 text-red-600 focus:ring-red-600 focus:ring-offset-0" data-extra="3000" value="extra queso" />
                  <span>Extra queso (+$3.000)</span>
                </label>
                <label class="inline-flex items-center gap-2 bg-zinc-800 rounded-full px-4 py-2.5 cursor-pointer hover:bg-zinc-700 transition active:bg-zinc-600">
                  <input type="checkbox" class="opt-extra w-4 h-4 rounded border-zinc-600 text-red-600 focus:ring-red-600 focus:ring-offset-0" data-extra="3000" value="extra bacon" />
                  <span>Extra bacon (+$3.000)</span>
                </label>
                <label class="inline-flex items-center gap-2 bg-zinc-800 rounded-full px-4 py-2.5 cursor-pointer hover:bg-zinc-700 transition active:bg-zinc-600">
                  <input type="checkbox" class="opt-extra w-4 h-4 rounded border-zinc-600 text-red-600 focus:ring-red-600 focus:ring-offset-0" data-extra="3000" value="carne extra" />
                  <span>Carne extra (+$3.000)</span>
                </label>
              </div>
            </div>

            <div class="mb-4">
              <label class="block text-sm font-medium text-zinc-300 mb-2">
                Notas especiales:
              </label>
              <textarea
                id="custom-notes"
                class="w-full bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-200 focus:outline-none focus:ring-2 focus:ring-red-600"
                rows="3"
                placeholder="Ej: bien cocida, sin sal, cortar a la mitad..."
              ></textarea>
            </div>
          </div>
        </div>

        <div class="p-4 sm:p-6 border-t border-zinc-800 flex-shrink-0">
          <button
            id="btn-add-customized"
            class="w-full rounded-full bg-red-600 hover:bg-red-700 px-6 py-3 text-sm font-semibold text-white transition active:scale-95"
            type="button"
          >
            Agregar al carrito
          </button>
        </div>
      </div>
    </div>

    <!-- MODAL DE CONFIRMACI√ìN -->
    <div
      id="confirm-add-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 hidden items-center justify-center p-4"
      role="dialog"
      aria-modal="true"
    >
      <div class="bg-zinc-900 border border-zinc-800 rounded-2xl max-w-md w-full shadow-2xl animate-slide-up">
        <div class="p-6">
          <h2 class="text-lg sm:text-xl font-semibold text-zinc-50 mb-3">
            ¬øQuer√©s personalizar tu pedido antes de agregarlo?
          </h2>
          <p class="text-sm text-zinc-300 mb-6">
            Pod√©s elegir el tama√±o (simple, doble o triple), sacar ingredientes o sumar extras como queso, bacon o carne extra.
          </p>
          <div class="flex flex-col sm:flex-row justify-end gap-3">
            <button
              id="btn-confirm-no"
              type="button"
              class="px-6 py-3 rounded-full text-sm bg-zinc-800 text-zinc-200 hover:bg-zinc-700 transition font-medium order-2 sm:order-1"
            >
              Agregar Simple
            </button>
            <button
              id="btn-confirm-yes"
              type="button"
              class="px-6 py-3 rounded-full text-sm bg-red-600 text-white font-semibold hover:bg-red-700 transition order-1 sm:order-2"
            >
              Personalizar pedido
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <style>
    html, body {
      margin: 0;
      min-height: 100svh;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideUp {
      from { transform: translateY(12px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .animate-slide-up { animation: slideUp 0.25s ease-out; }
    .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    .product-image { transition: opacity 0.5s ease-in-out; }
    .product-image.loaded { opacity: 1 !important; }

    input[type="checkbox"], input[type="radio"], input[type="text"], textarea, button {
      touch-action: manipulation;
    }

    input[type="radio"].size-radio, input[type="radio"].payment-radio {
      appearance: none;
      -webkit-appearance: none;
      width: 1.25rem;
      height: 1.25rem;
      border: 2px solid #52525b;
      border-radius: 50%;
      background-color: #27272a;
      cursor: pointer;
      position: relative;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    input[type="radio"].size-radio:checked, input[type="radio"].payment-radio:checked {
      background-color: #dc2626;
      border-color: #dc2626;
    }

    input[type="radio"].size-radio:checked::after, input[type="radio"].payment-radio:checked::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 0.5rem;
      height: 0.5rem;
      background-color: #ffffff;
      border-radius: 50%;
    }

    .size-option:has(input:checked), .payment-option:has(input:checked) {
      border-color: #dc2626 !important;
      background-color: #3f1d1d !important;
    }

    input[type="checkbox"].opt-remove, input[type="checkbox"].opt-extra {
      appearance: none;
      -webkit-appearance: none;
      width: 1rem;
      height: 1rem;
      border: 2px solid #52525b;
      border-radius: 0.25rem;
      background-color: #27272a;
      cursor: pointer;
      position: relative;
      flex-shrink: 0;
      transition: all 0.2s;
    }

    input[type="checkbox"].opt-remove:checked, input[type="checkbox"].opt-extra:checked {
      background-color: #dc2626;
      border-color: #dc2626;
    }

    input[type="checkbox"].opt-remove:checked::after, input[type="checkbox"].opt-extra:checked::after {
      content: "‚úì";
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #ffffff;
      font-size: 0.75rem;
      font-weight: bold;
    }

    @media (max-width: 640px) {
      #confirm-add-modal .bg-zinc-900,
      #customize-modal .bg-zinc-900,
      #cart-modal .bg-zinc-900,
      #payment-modal .bg-zinc-900 {
        max-height: 90vh;
      }

      label {
        min-height: 44px;
        display: inline-flex;
        align-items: center;
      }
    }
  </style>

  <script define:vars={{ 
    WHATSAPP_NUMBER, 
    ALIAS_TRANSFERENCIA,
    HORA_ENTREGA_ESTIMADA 
  }}>
    document.addEventListener("DOMContentLoaded", () => {
      // ============ LAZY LOADING ============
      const imageObserver = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const img = entry.target;
            const src = img.dataset.src;
            if (src) {
              const tempImg = new Image();
              tempImg.onload = () => {
                img.src = src;
                img.classList.add('loaded');
                img.removeAttribute('data-src');
              };
              tempImg.onerror = () => {
                console.warn('Error cargando imagen:', src);
                img.classList.add('loaded');
              };
              tempImg.src = src;
              observer.unobserve(img);
            }
          }
        });
      }, {
        rootMargin: '50px',
        threshold: 0.01
      });

      document.querySelectorAll('.product-image').forEach(img => {
        imageObserver.observe(img);
      });

      // ============ VERIFICACI√ìN DE HORARIOS ============
      function checkBusinessStatus() {
        const now = new Date();
        const currentHour = now.getHours();
        const currentMinutes = now.getMinutes();
        const currentTime = currentHour + currentMinutes / 60;
        const openTime = 19;
        const closeTime = 24;
        const isOpen = currentTime >= openTime && currentTime < closeTime;
        
        const statusBanner = document.getElementById('status-banner');
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');
        const deliveryTime = document.getElementById('delivery-time');
        
        if (statusBanner && statusIndicator && statusText) {
          if (isOpen) {
            statusBanner.className = 'bg-black border border-green-500 rounded-2xl p-4 mb-4 flex flex-col sm:flex-row items-start sm:items-center gap-3';
            statusIndicator.className = 'w-3 h-3 bg-green-400 rounded-full animate-pulse';
            statusText.className = 'text-green-400 font-semibold text-sm';
            statusText.textContent = 'Abierto ahora';
            if (deliveryTime) deliveryTime.style.display = 'inline';
          } else {
            statusBanner.className = 'bg-black border border-red-500 rounded-2xl p-4 mb-4 flex flex-col sm:flex-row items-start sm:items-center gap-3';
            statusIndicator.className = 'w-3 h-3 bg-red-400 rounded-full';
            statusText.className = 'text-red-400 font-semibold text-sm';
            statusText.textContent = 'Cerrado';
            if (deliveryTime) deliveryTime.style.display = 'none';
          }
        }
        return isOpen;
      }
      
      const businessIsOpen = checkBusinessStatus();
      setInterval(checkBusinessStatus, 60000);

      // ============ PERSISTENCIA DEL CARRITO ============
      const CART_STORAGE_KEY = 'bennys-cart';
      const CART_EXPIRY_KEY = 'bennys-cart-expiry';
      const CART_EXPIRY_HOURS = 24;

      function saveCart(cartData) {
        try {
          const now = new Date().getTime();
          const expiryTime = now + (CART_EXPIRY_HOURS * 60 * 60 * 1000);
          localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cartData));
          localStorage.setItem(CART_EXPIRY_KEY, expiryTime.toString());
        } catch (error) {
          console.warn('‚ö†Ô∏è Error al guardar el carrito:', error);
        }
      }

      function loadCart() {
        try {
          const expiryTime = localStorage.getItem(CART_EXPIRY_KEY);
          const now = new Date().getTime();
          if (expiryTime && now > parseInt(expiryTime)) {
            clearCart();
            return [];
          }
          const savedCart = localStorage.getItem(CART_STORAGE_KEY);
          if (savedCart) {
            const parsedCart = JSON.parse(savedCart);
            if (parsedCart.length > 0) {
              setTimeout(() => {
                showNotification(`üõí Tienes ${parsedCart.length} ${parsedCart.length === 1 ? 'producto' : 'productos'} en tu carrito`);
              }, 500);
            }
            return parsedCart;
          }
        } catch (error) {
          console.warn('‚ö†Ô∏è Error al cargar el carrito:', error);
          clearCart();
        }
        return [];
      }

      function clearCart() {
        localStorage.removeItem(CART_STORAGE_KEY);
        localStorage.removeItem(CART_EXPIRY_KEY);
      }

      // ============ DATOS DEL CARRITO ============
      let cart = loadCart();
      let currentCustomizingProduct = null;
      let pendingProductId = null;
      let editingCartIndex = null;

      const btnOpenCart = document.getElementById("btn-open-cart");
      const btnCloseCart = document.getElementById("btn-close-cart");
      const cartModal = document.getElementById("cart-modal");
      const cartItems = document.getElementById("cart-items");
      const cartTotal = document.getElementById("cart-total");
      const cartCount = document.getElementById("cart-count");
      const btnWhatsApp = document.getElementById("btn-whatsapp");
      const btnClearCart = document.getElementById("btn-clear-cart");

      const customizeModal = document.getElementById("customize-modal");
      const btnCloseCustomize = document.getElementById("btn-close-customize");
      const customNotes = document.getElementById("custom-notes");
      const btnAddCustomized = document.getElementById("btn-add-customized");

      const confirmModal = document.getElementById("confirm-add-modal");
      const btnConfirmNo = document.getElementById("btn-confirm-no");
      const btnConfirmYes = document.getElementById("btn-confirm-yes");

      const paymentModal = document.getElementById("payment-modal");
      const btnClosePayment = document.getElementById("btn-close-payment");
      const btnSendOrder = document.getElementById("btn-send-order");
      const btnCopyAlias = document.getElementById("btn-copy-alias");

      const extraOptions = document.querySelectorAll(".opt-extra");
      const sizeRadios = document.querySelectorAll(".size-radio");

      const productsData = Array.from(document.querySelectorAll(".product-card")).map((card) => {
        const id = card.dataset.id;
        const name = card.querySelector(".product-name")?.textContent?.trim() || "";
        const image = card.querySelector(".product-image")?.getAttribute("data-src") || "";
        const description = card.querySelector(".product-description")?.textContent?.trim() || "";
        const category = card.dataset.category || "todos";
        const priceElement = card.querySelector(".product-price");
        const priceText = priceElement?.textContent?.trim() || "";
        const price = priceText.startsWith("$") ? parseFloat(priceText.replace(/\$|\.|\,/g, "")) : null;
        const ingredientsStr = card.dataset.ingredients || "[]";
        let ingredients = [];
        try {
          ingredients = JSON.parse(ingredientsStr);
        } catch (e) {
          console.warn("Error parsing ingredients for product", id, e);
        }
        return { id, name, image, description, category, price, ingredients };
      });

      // ============ MANEJO DEL MODAL DE PAGO ============
      const paymentRadios = document.querySelectorAll('input[name="payment-method"]');
      const transferInfo = document.getElementById('transfer-info');
      const cashInfo = document.getElementById('cash-info');
      const paymentTotal = document.getElementById('payment-total');
      const cashTotal = document.getElementById('cash-total');

      paymentRadios.forEach(radio => {
        radio.addEventListener('change', () => {
          if (radio.value === 'transferencia') {
            transferInfo.classList.remove('hidden');
            cashInfo.classList.add('hidden');
          } else {
            transferInfo.classList.add('hidden');
            cashInfo.classList.remove('hidden');
          }
        });
      });

      btnCopyAlias?.addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(ALIAS_TRANSFERENCIA);
          showNotification('‚úÖ Alias copiado al portapapeles');
        } catch (error) {
          showNotification('‚ö†Ô∏è No se pudo copiar el alias');
        }
      });

      // ============ INGREDIENTES DIN√ÅMICOS ============
      function renderRemoveIngredientsOptions(ingredients) {
        const section = document.getElementById('remove-ingredients-section');
        if (!ingredients || ingredients.length === 0) {
          section.innerHTML = '';
          return;
        }
        const html = `
          <h3 class="text-sm font-semibold text-zinc-100 mb-2">¬øQuer√©s sacar algo?</h3>
          <p class="text-xs text-zinc-400 mb-3">Tild√° lo que NO quer√©s que lleve tu pedido:</p>
          <div class="flex flex-wrap gap-2 text-xs text-zinc-200">
            ${ingredients.map(ingredient => `
              <label class="inline-flex items-center gap-2 bg-zinc-800 rounded-full px-4 py-2.5 cursor-pointer hover:bg-zinc-700 transition active:bg-zinc-600">
                <input type="checkbox" class="opt-remove w-4 h-4 rounded border-zinc-600 text-red-600 focus:ring-red-600 focus:ring-offset-0" value="sin ${ingredient.toLowerCase()}" />
                <span>Sin ${ingredient}</span>
              </label>
            `).join('')}
          </div>
        `;
        section.innerHTML = html;
      }

      // ============ FUNCIONES DE CARRITO ============
      function addToCart(productId, options = {}) {
        if (!checkBusinessStatus()) {
          showNotification("‚ö†Ô∏è Lo sentimos, estamos cerrados. Horario: 19:00 - 00:00");
          return;
        }

        const product = productsData.find((p) => p.id === String(productId));
        if (!product) return;

        if (product.category === "bebidas" || product.category === "postres") {
          cart.push({ ...product, price: product.price, quantity: 1, notes: "" });
          updateCart();
          showNotification(`‚úÖ "${product.name}" agregado al carrito`);
          return;
        }

        const size = options.size || "simple";
        const basePrice = options.basePrice || 10900;
        const notes = options.notes || "";
        const extraAmount = options.extraAmount || 0;
        const finalPrice = basePrice + extraAmount;
        const sizeName = size === "simple" ? "Simple" : size === "doble" ? "Doble" : "Triple";
        const fullName = `${product.name} ${sizeName}`;

        cart.push({ ...product, name: fullName, size, price: finalPrice, basePrice, extraAmount, quantity: 1, notes });
        updateCart();
        showNotification(`‚úÖ "${fullName}" agregado al carrito`);
      }

      function removeFromCart(index) {
        const item = cart[index];
        cart.splice(index, 1);
        updateCart();
        showNotification(`üóëÔ∏è "${item.name}" eliminado del carrito`);
      }

      function updateQuantity(index, delta) {
        cart[index].quantity += delta;
        if (cart[index].quantity <= 0) {
          removeFromCart(index);
        } else {
          updateCart();
        }
      }

      function calculateTotal() {
        return cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
      }

      function updateCart() {
        saveCart(cart);
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        cartCount.textContent = totalItems;

        if (cart.length === 0) {
          cartItems.innerHTML = `<p class="text-zinc-400 text-sm text-center py-8">Tu carrito est√° vac√≠o</p>`;
          btnWhatsApp.disabled = true;
          btnClearCart.disabled = true;
        } else {
          cartItems.innerHTML = cart.map((item, index) => {
            const isBeverageOrDessert = item.category === "bebidas" || item.category === "postres";
            return `
              <div class="flex gap-3 mb-4 pb-4 border-b border-zinc-800 last:border-0">
                <img src="${item.image}" alt="${item.name}" class="w-16 h-16 rounded-lg object-cover bg-zinc-800" loading="lazy" />
                <div class="flex-1">
                  <div class="flex items-start justify-between">
                    <h3 class="text-sm font-medium text-zinc-50">${item.name}</h3>
                    <p class="text-xs text-zinc-400">$${item.price.toLocaleString("es-AR")}</p>
                  </div>
                  ${item.notes ? `<p class="text-xs text-red-400 italic mt-1">${item.notes}</p>` : ""}
                  <div class="flex items-center gap-2 mt-2">
                    <button class="btn-decrease w-6 h-6 rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-300 text-sm transition" data-index="${index}">‚àí</button>
                    <span class="text-sm text-zinc-300 min-w-[20px] text-center">${item.quantity}</span>
                    <button class="btn-increase w-6 h-6 rounded bg-zinc-800 hover:bg-zinc-700 text-zinc-300 text-sm transition" data-index="${index}">+</button>
                    <div class="ml-auto flex flex-col items-end gap-1">
                      ${!isBeverageOrDessert ? `<button class="btn-edit text-xs text-red-400 hover:text-red-300 transition" data-index="${index}">Personalizar</button>` : ''}
                      <button class="btn-remove text-xs text-red-400 hover:text-red-300 transition" data-index="${index}">Eliminar</button>
                    </div>
                  </div>
                </div>
              </div>`;
          }).join("");

          document.querySelectorAll(".btn-decrease").forEach((btn) => {
            btn.addEventListener("click", () => updateQuantity(parseInt(btn.dataset.index), -1));
          });
          document.querySelectorAll(".btn-increase").forEach((btn) => {
            btn.addEventListener("click", () => updateQuantity(parseInt(btn.dataset.index), 1));
          });
          document.querySelectorAll(".btn-remove").forEach((btn) => {
            btn.addEventListener("click", () => removeFromCart(parseInt(btn.dataset.index)));
          });
          document.querySelectorAll(".btn-edit").forEach((btn) => {
            btn.addEventListener("click", () => {
              const index = parseInt(btn.dataset.index);
              const item = cart[index];
              if (!item) return;
              editingCartIndex = index;
              currentCustomizingProduct = item.id;
              const originalProduct = productsData.find((p) => p.id === item.id);
              if (originalProduct && originalProduct.ingredients) {
                renderRemoveIngredientsOptions(originalProduct.ingredients);
              }
              sizeRadios.forEach((radio) => { radio.checked = radio.value === item.size; });
              document.querySelectorAll(".opt-remove").forEach((o) => (o.checked = false));
              extraOptions.forEach((o) => (o.checked = false));
              customNotes.value = item.notes || "";
              openModal(customizeModal);
            });
          });

          btnWhatsApp.disabled = false;
          btnClearCart.disabled = false;
        }

        cartTotal.textContent = `$${calculateTotal().toLocaleString("es-AR")}`;
      }

      btnClearCart?.addEventListener("click", () => {
        if (cart.length === 0) return;
        if (confirm("¬øEst√°s seguro de que quer√©s vaciar el carrito?")) {
          cart = [];
          updateCart();
          showNotification("üóëÔ∏è Carrito vaciado");
        }
      });

      // ============ MODAL HANDLERS ============
      function preventScroll(e) {
        if (e.target.closest("#cart-modal") || e.target.closest("#customize-modal") || 
            e.target.closest("#confirm-add-modal") || e.target.closest("#payment-modal")) return;
        e.preventDefault();
      }

      function openModal(modal) {
        modal.classList.remove("hidden");
        modal.classList.add("flex");
        document.body.style.overflow = "hidden";
        modal.offsetHeight;
        document.addEventListener("touchmove", preventScroll, { passive: false });
      }

      function closeModal(modal) {
        modal.classList.add("hidden");
        modal.classList.remove("flex");
        document.body.style.overflow = "";
        document.removeEventListener("touchmove", preventScroll);
      }

      btnOpenCart?.addEventListener("click", () => openModal(cartModal));
      btnCloseCart?.addEventListener("click", () => closeModal(cartModal));
      cartModal?.addEventListener("click", (e) => { if (e.target === cartModal) closeModal(cartModal); });

      btnCloseCustomize?.addEventListener("click", () => {
        closeModal(customizeModal);
        currentCustomizingProduct = null;
        editingCartIndex = null;
        renderRemoveIngredientsOptions([]);
        sizeRadios.forEach((radio) => { radio.checked = radio.value === "simple"; });
        extraOptions.forEach((o) => (o.checked = false));
        customNotes.value = "";
      });

      customizeModal?.addEventListener("click", (e) => {
        if (e.target === customizeModal) {
          closeModal(customizeModal);
          currentCustomizingProduct = null;
          editingCartIndex = null;
          renderRemoveIngredientsOptions([]);
        }
      });

      confirmModal?.addEventListener("click", (e) => { if (e.target === confirmModal) closeModal(confirmModal); });

      btnClosePayment?.addEventListener("click", () => closeModal(paymentModal));
      paymentModal?.addEventListener("click", (e) => { if (e.target === paymentModal) closeModal(paymentModal); });

      // ============ BOTONES DE PRODUCTOS ============
      document.querySelectorAll(".btn-add").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          if (!checkBusinessStatus()) {
            showNotification("‚ö†Ô∏è Lo sentimos, estamos cerrados. Horario: 19:00 - 00:00");
            return;
          }
          const productId = btn.dataset.productId;
          const product = productsData.find((p) => p.id === String(productId));
          if (product && (product.category === "bebidas" || product.category === "postres")) {
            addToCart(productId);
            return;
          }
          pendingProductId = productId;
          editingCartIndex = null;
          openModal(confirmModal);
        });
      });

      document.querySelectorAll(".btn-customize").forEach((btn) => {
        btn.addEventListener("click", (e) => {
          e.preventDefault();
          e.stopPropagation();
          const productId = btn.dataset.productId;
          currentCustomizingProduct = productId;
          pendingProductId = null;
          editingCartIndex = null;
          const product = productsData.find((p) => p.id === String(productId));
          if (product && product.ingredients) {
            renderRemoveIngredientsOptions(product.ingredients);
          } else {
            renderRemoveIngredientsOptions([]);
          }
          sizeRadios.forEach((radio) => { radio.checked = radio.value === "simple"; });
          extraOptions.forEach((o) => (o.checked = false));
          customNotes.value = "";
          openModal(customizeModal);
        });
      });

      btnConfirmNo?.addEventListener("click", () => {
        if (!pendingProductId) {
          closeModal(confirmModal);
          return;
        }
        addToCart(pendingProductId, { size: "simple", basePrice: 10900, notes: "", extraAmount: 0 });
        pendingProductId = null;
        closeModal(confirmModal);
      });

      btnConfirmYes?.addEventListener("click", () => {
        if (!pendingProductId) {
          closeModal(confirmModal);
          return;
        }
        currentCustomizingProduct = pendingProductId;
        editingCartIndex = null;
        const product = productsData.find((p) => p.id === String(pendingProductId));
        if (product && product.ingredients) {
          renderRemoveIngredientsOptions(product.ingredients);
        } else {
          renderRemoveIngredientsOptions([]);
        }
        sizeRadios.forEach((radio) => { radio.checked = radio.value === "simple"; });
        extraOptions.forEach((o) => (o.checked = false));
        customNotes.value = "";
        openModal(customizeModal);
        pendingProductId = null;
        closeModal(confirmModal);
      });

      btnAddCustomized?.addEventListener("click", () => {
        if (!currentCustomizingProduct) return;
        const selectedSize = document.querySelector('input[name="burger-size"]:checked');
        if (!selectedSize) {
          showNotification("‚ö†Ô∏è Por favor seleccion√° un tama√±o");
          return;
        }
        const size = selectedSize.value;
        const basePrice = parseInt(selectedSize.dataset.price);
        const notesParts = [];
        let extraAmount = 0;
        const removeOptions = document.querySelectorAll(".opt-remove");
        removeOptions.forEach((opt) => { if (opt.checked) notesParts.push(opt.value); });
        extraOptions.forEach((opt) => {
          if (opt.checked) {
            const extra = parseFloat(opt.dataset.extra || "0");
            extraAmount += extra;
            notesParts.push(`${opt.value} (+${extra.toLocaleString("es-AR")})`);
          }
        });
        if (customNotes.value.trim()) notesParts.push(customNotes.value.trim());
        const notes = notesParts.join(" | ");

        if (editingCartIndex !== null) {
          const product = productsData.find((p) => p.id === String(currentCustomizingProduct));
          if (!product || !cart[editingCartIndex]) {
            console.warn("Error al editar");
          } else {
            const item = cart[editingCartIndex];
            const sizeName = size === "simple" ? "Simple" : size === "doble" ? "Doble" : "Triple";
            item.name = `${product.name.replace(/ (Simple|Doble|Triple)$/, "")} ${sizeName}`;
            item.size = size;
            item.basePrice = basePrice;
            item.extraAmount = extraAmount;
            item.price = basePrice + extraAmount;
            item.notes = notes;
            updateCart();
            showNotification("‚úÖ Producto actualizado");
          }
        } else {
          addToCart(currentCustomizingProduct, { size, basePrice, notes, extraAmount });
        }

        closeModal(customizeModal);
        currentCustomizingProduct = null;
        editingCartIndex = null;
        renderRemoveIngredientsOptions([]);
        sizeRadios.forEach((radio) => { radio.checked = radio.value === "simple"; });
        extraOptions.forEach((o) => (o.checked = false));
        customNotes.value = "";
      });

      // ============ BOT√ìN WHATSAPP ============
      btnWhatsApp?.addEventListener("click", () => {
        if (cart.length === 0) return;
        if (!checkBusinessStatus()) {
          showNotification("‚ö†Ô∏è Lo sentimos, estamos cerrados. Horario: 19:00 - 00:00");
          return;
        }
        
        // Actualizar totales en el modal de pago
        const total = calculateTotal();
        paymentTotal.textContent = `$${total.toLocaleString("es-AR")}`;
        cashTotal.textContent = `$${total.toLocaleString("es-AR")}`;
        
        // Resetear formulario
        document.querySelector('input[name="payment-method"][value="transferencia"]').checked = true;
        transferInfo.classList.remove('hidden');
        cashInfo.classList.add('hidden');
        document.getElementById('delivery-address').value = '';
        
        closeModal(cartModal);
        openModal(paymentModal);
      });

      btnSendOrder?.addEventListener("click", () => {
        if (cart.length === 0) return;
        
        const address = document.getElementById('delivery-address').value.trim();
        if (!address) {
          showNotification('‚ö†Ô∏è Por favor ingres√° tu direcci√≥n de entrega');
          return;
        }
        
        const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value;
        const paymentLabel = paymentMethod === 'transferencia' ? 'üü¢ Transferencia' : 'üíµ Efectivo';
        
        let mensaje = "¬°Hola! Quiero hacer el siguiente pedido:%0A%0A";
        
        cart.forEach((item) => {
          const subtotal = item.price * item.quantity;
          mensaje += `üçî ${item.quantity}x ${item.name} - $${subtotal.toLocaleString("es-AR")}%0A`;
          if (item.notes) {
            mensaje += `‚ö†Ô∏è ${item.notes}%0A`;
          }
        });
        
        mensaje += `%0Aüí∞ *Total: $${calculateTotal().toLocaleString("es-AR")}*`;
        mensaje += `%0A%0Aüìç *Direcci√≥n:* ${encodeURIComponent(address)}`;
        mensaje += `%0Aüí≥ *Forma de pago:* ${paymentLabel}`;
        
        if (paymentMethod === 'transferencia') {
          mensaje += `%0A%0Aüü¢ *Voy a transferir al alias:* ${ALIAS_TRANSFERENCIA}`;
          mensaje += `%0A_Adjunto el comprobante en el siguiente mensaje_`;
        } else {
          mensaje += `%0A%0Aüíµ *Pago en efectivo al recibir*`;
        }
        
        const url = `https://wa.me/${WHATSAPP_NUMBER}?text=${mensaje}`;
        window.open(url, "_blank");
        
        closeModal(paymentModal);
        showNotification('‚úÖ Pedido enviado. Te contactaremos por WhatsApp');
      });

      // ============ FILTROS ============
      let activeFilter = "todos";
      const filterButtons = document.querySelectorAll(".filter-btn");
      const cards = document.querySelectorAll(".product-card");
      const productsCount = document.getElementById("products-count");

      function aplicarFiltro() {
        let visibleCount = 0;
        cards.forEach((card) => {
          const cardCategory = card.dataset.category;
          const shouldShow = activeFilter === "todos" || cardCategory === activeFilter;
          if (shouldShow) {
            card.classList.remove("hidden");
            card.style.animation = "fadeIn 0.4s ease-out";
            visibleCount++;
          } else {
            card.classList.add("hidden");
          }
        });
        if (productsCount) productsCount.textContent = visibleCount;
      }

      filterButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          activeFilter = btn.dataset.filter;
          filterButtons.forEach((b) => {
            b.classList.remove("bg-red-600", "border-red-600", "text-white", "font-semibold", "shadow", "shadow-red-500/40");
            b.classList.add("bg-zinc-900", "border-zinc-700", "text-zinc-300");
          });
          btn.classList.remove("bg-zinc-900", "border-zinc-700", "text-zinc-300");
          btn.classList.add("bg-red-600", "border-red-600", "text-white", "font-semibold", "shadow", "shadow-red-500/40");
          aplicarFiltro();
        });
      });

      aplicarFiltro();

      // ============ NOTIFICACIONES ============
      function showNotification(message) {
        const notification = document.createElement("div");
        notification.className = "fixed bottom-4 right-4 bg-zinc-800 border border-zinc-700 text-white px-6 py-3 rounded-lg shadow-lg z-50 animate-slide-up max-w-[90vw]";
        notification.textContent = message;
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.style.opacity = "0";
          notification.style.transform = "translateY(20px)";
          notification.style.transition = "all 0.3s ease-out";
          setTimeout(() => notification.remove(), 300);
        }, 3000);
      }

      updateCart();
    });
  </script>
</Layout>